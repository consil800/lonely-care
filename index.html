<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ğŸš¨ ULTIMATE: WebView ìºì‹œ ì™„ì „ ë¬´íš¨í™” -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="Mon, 04 Oct 2025 08:00:00 GMT">
    <meta name="cache-version" content="v13.5.1-ultimate-cache-break-1730695200">
    <meta name="webview-cache-buster" content="file-rename-method-active">
    
    <!-- ğŸ”¥ FORCE: WebView ê°•ì œ ë¦¬ë¡œë“œ -->
    <script>
        // WebView ìºì‹œ ê°•ì œ í´ë¦¬ì–´
        if (window.location.protocol === 'file:') {
            console.log('ğŸš¨ [CACHE-BREAK] WebView ìºì‹œ ë¬´íš¨í™” ê°•ì œ ì‹¤í–‰');
            if (typeof Storage !== 'undefined') {
                try {
                    localStorage.setItem('cache-break-timestamp', Date.now());
                    sessionStorage.setItem('cache-break-version', 'v13.5.1-ultimate');
                } catch(e) {}
            }
        }
        
        // ğŸš¨ ìƒëª…êµ¬ì¡°: ì¹œêµ¬ ëª©ë¡ ìŠ¤í”¼ë„ˆ ìƒíƒœ ì´ˆê¸°í™”
        window.friendsSpinnerHandled = false;
        console.log('ğŸ”„ ì¹œêµ¬ ëª©ë¡ ìŠ¤í”¼ë„ˆ ìƒíƒœ ì´ˆê¸°í™” ì™„ë£Œ');
    </script>
    
    <title>lonely-care - ê³ ë…ì‚¬ ë°©ì§€ ì•±</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="apple-touch-icon" href="icon.png">
    <!-- ê¸°ë³¸ CSS + ì™„ì „ ë¶„ë¦¬ëœ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ CSS íŒŒì¼ë“¤ -->
    <link rel="stylesheet" href="css/base.css?v=20251007">
    <link rel="stylesheet" href="css/login.css?v=20251007">
    <!-- ê° í˜ì´ì§€ë³„ ì™„ì „ ë¶„ë¦¬ëœ CSS - ì¶©ëŒ ë°©ì§€ -->
    <link rel="stylesheet" href="css/friends-isolated.css?v=20251007-final-fix">
    <link rel="stylesheet" href="css/status-isolated.css?v=20251007">
    <link rel="stylesheet" href="css/ads-isolated.css?v=20251007-tabs-fix">
    <link rel="stylesheet" href="css/notifications-isolated.css?v=20251007">
    <link rel="stylesheet" href="css/profile-isolated.css?v=20251007">
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js" 
            crossorigin="anonymous"></script>
    <!-- Firebase SDK v10 (compat mode) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-messaging-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-analytics-compat.js"></script>
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .kakao-login-btn {
            width: 100%;
            background: #FEE500;
            color: #3C1E1E;
            border: none;
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(254, 229, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .kakao-login-btn:hover {
            background: #F7DD00;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(254, 229, 0, 0.4);
        }

        .kakao-login-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
            transform: none;
        }

        .kakao-login-btn img {
            width: 20px;
            height: 20px;
        }

        /* ë¡œê·¸ì¸ ì§„í–‰ ìƒí™© ìŠ¤íƒ€ì¼ */
        #login-progress {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .login-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(60, 30, 30, 0.3);
            border-top: 2px solid #3C1E1E;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        #login-status {
            font-size: 14px;
            color: #3C1E1E;
        }

        /* ì»¨í…Œì´ë„ˆ ì „ì²´ ë†’ì´ ì¡°ì • */
        .container {
            max-width: 400px !important;
            margin: 0 auto !important;
            background: white !important;
            height: 100vh !important;
            position: relative !important;
            overflow: hidden !important;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ë°” í•˜ë‹¨ ê³ ì • */
        .bottom-nav {
            position: fixed !important;
            bottom: 0 !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            max-width: 400px !important;
            width: 100% !important;
            background: white !important;
            border-top: 1px solid #e0e0e0 !important;
            display: flex !important;
            justify-content: space-around !important;
            padding: 10px 0 8px 0 !important;
            z-index: 1000 !important;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1) !important;
        }

        .nav-item {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            background: none !important;
            border: none !important;
            padding: 6px 4px !important;
            cursor: pointer !important;
            transition: color 0.3s !important;
            color: #666 !important;
            text-decoration: none !important;
            flex: 1 !important;
        }

        .nav-item.active {
            color: #74c0fc !important;
        }

        .nav-icon {
            font-size: 18px !important;
            margin-bottom: 2px !important;
        }

        .nav-text {
            font-size: 9px !important;
            font-weight: 500 !important;
            text-align: center !important;
            line-height: 1.1 !important;
            white-space: nowrap !important;
        }

        /* ë©”ì¸ ì•± ì»¨í…Œì´ë„ˆ */
        #main-app {
            display: none !important;
            height: 100vh !important;
            overflow: hidden !important;
        }

        #main-app.show {
            display: block !important;
        }

        /* ì•± ì»¨í…ì¸  */
        .app-content {
            height: calc(100vh - 70px) !important;
            overflow: hidden !important;
            padding: 0 !important;
        }

        /* í˜ì´ì§€ ìŠ¤íƒ€ì¼ - ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸° */
        .page {
            display: none !important;
            height: calc(100vh - 70px) !important;
            overflow-y: auto !important;
            padding: 20px 20px 0 20px !important;
            box-sizing: border-box !important;
        }

        .page.active {
            display: block !important;
        }

        /* ë¡œê·¸ì¸ í˜ì´ì§€ëŠ” íŒ¨ë”© ì—†ì´ */
        #login-page {
            padding: 0 !important;
            height: 100vh !important;
        }

        /* ê´‘ê³  ë°°ë„ˆ ê°•ì œ ìŠ¤íƒ€ì¼ ì ìš© - 2024 í˜„ëŒ€ì  ë””ìì¸ */
        .ad-banner {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%) !important;
            color: #1e293b !important;
            padding: 24px 20px !important;
            border-radius: 16px !important;
            box-shadow: 0 4px 20px rgba(15, 23, 42, 0.08) !important;
            text-align: center !important;
            margin-bottom: 16px !important;
            position: relative !important;
            overflow: hidden !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            cursor: default !important;
            border: 1px solid rgba(226, 232, 240, 0.8) !important;
            backdrop-filter: blur(10px) !important;
        }

        .ad-banner:hover {
            transform: translateY(-4px) !important;
            box-shadow: 0 12px 40px rgba(15, 23, 42, 0.12) !important;
            border-color: #3b82f6 !important;
        }

        .ad-banner h3 {
            margin-bottom: 8px !important;
            color: #0f172a !important;
            font-size: 1.25rem !important;
            font-weight: 600 !important;
            letter-spacing: -0.025em !important;
            line-height: 1.4 !important;
        }

        .ad-banner p {
            color: #64748b !important;
            margin-bottom: 18px !important;
            font-size: 0.95rem !important;
            line-height: 1.5 !important;
            font-weight: 400 !important;
        }

        .ad-banner button {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
            color: white !important;
            border: none !important;
            padding: 12px 28px !important;
            border-radius: 12px !important;
            cursor: pointer !important;
            font-weight: 600 !important;
            font-size: 0.9rem !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            letter-spacing: 0.025em !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
        }

        .ad-banner button:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4) !important;
        }
    </style>
</head>
<body style="margin: 0; padding: 0;">
    <!-- ìŠ¤í”Œë˜ì‹œ ìŠ¤í¬ë¦° (ê°•ì œ íƒ€ì„ì•„ì›ƒ í¬í•¨) -->
    <div id="splash-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #74c0fc 0%, #91c3ff 100%); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999;">
        <div style="display: flex; flex-direction: column; align-items: center;">
            <img src="icon.png" alt="lonely-care" style="width: 120px; height: 120px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
            <h1 style="color: white; font-size: 28px; font-weight: bold; margin: 0; text-shadow: 0 2px 10px rgba(0,0,0,0.3);">lonely-care</h1>
            <p style="color: rgba(255,255,255,0.8); font-size: 16px; margin: 10px 0; text-shadow: 0 1px 5px rgba(0,0,0,0.2);">ì•ˆì „í•œ ì¼ìƒì„ í•¨ê»˜</p>
            <div style="margin-top: 30px;">
                <div class="loading-spinner" style="width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            </div>
            <p id="splash-status" style="color: rgba(255,255,255,0.6); font-size: 12px; margin-top: 15px; text-align: center; max-width: 250px;">ì•±ì„ ì‹œì‘í•˜ëŠ” ì¤‘...</p>
            <div id="splash-progress" style="width: 200px; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; margin-top: 10px; overflow: hidden;">
                <div id="splash-progress-bar" style="width: 0%; height: 100%; background: white; border-radius: 2px; transition: width 0.3s ease;"></div>
            </div>
        </div>
    </div>

    <!-- ê¸´ê¸‰ ìŠ¤í”Œë˜ì‹œ íƒ€ì„ì•„ì›ƒ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        console.log('ğŸš¨ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œë¨');
        
        // ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬ - Firebase ì¸ì¦ê³¼ ì—°ë™
        var savedUser = localStorage.getItem('currentUser');
        var isLoggedIn = false;
        
        // Firebase ì¸ì¦ ìƒíƒœì™€ í•¨ê»˜ ì²´í¬
        if (savedUser) {
            try {
                var userData = JSON.parse(savedUser);
                // ìœ íš¨í•œ ì‚¬ìš©ì ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸ (ì¹´ì¹´ì˜¤ IDì™€ ì´ë¦„ í•„ìˆ˜)
                if (userData && userData.id && userData.name && (userData.kakao_id || userData.kakaoId)) {
                    isLoggedIn = true;
                    console.log('âœ… ìœ íš¨í•œ ë¡œê·¸ì¸ ì„¸ì…˜ ë°œê²¬:', userData.name);
                } else {
                    console.log('âš ï¸ ë¶ˆì™„ì „í•œ ì‚¬ìš©ì ë°ì´í„°, ë¡œê·¸ì¸ í•„ìš”');
                    localStorage.removeItem('currentUser');
                }
            } catch (e) {
                console.log('ì €ì¥ëœ ì‚¬ìš©ì ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', e);
                localStorage.removeItem('currentUser');
            }
        }
        
        console.log('ğŸ’¾ ì €ì¥ëœ ë¡œê·¸ì¸ ìƒíƒœ:', isLoggedIn, savedUser ? '(ì‚¬ìš©ì ë°ì´í„° ìˆìŒ)' : '(ì‚¬ìš©ì ë°ì´í„° ì—†ìŒ)');
        
        // ì „ì—­ ë³€ìˆ˜ì— ë¡œê·¸ì¸ ìƒíƒœ ì„¤ì • (main.jsì—ì„œ ì°¸ì¡°ìš©)
        window.initialLoginState = isLoggedIn;
        
        // ìŠ¤í”Œë˜ì‹œ í™”ë©´ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        function updateSplashStatus(message, progress = 0) {
            const statusElement = document.getElementById('splash-status');
            const progressBar = document.getElementById('splash-progress-bar');
            if (statusElement) statusElement.textContent = message;
            if (progressBar) progressBar.style.width = progress + '%';
            console.log('ğŸ”„ ' + message + ' (' + progress + '%)');
        }

        // Firebase ì—°ê²° ëŒ€ê¸° í•¨ìˆ˜ (ìƒˆë¡œìš´ ì´ˆê¸°í™” ì‹œìŠ¤í…œ ì‚¬ìš©)
        async function waitForFirebase() {
            try {
                updateSplashStatus('Firebase ì´ˆê¸°í™” ê´€ë¦¬ì ëŒ€ê¸° ì¤‘...', 40);
                
                // Firebase ì´ˆê¸°í™” ê´€ë¦¬ìê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
                let attempts = 0;
                const maxAttempts = 50;
                
                while (!window.firebaseInitializer && attempts < maxAttempts) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                // HTTPS í™˜ê²½ í™•ì¸ ë° ìë™ ì „í™˜
                if (window.httpsManager) {
                    updateSplashStatus('ë³´ì•ˆ í™˜ê²½ í™•ì¸ ì¤‘...', 40);
                    const envInfo = window.httpsManager.getEnvironmentInfo();
                    console.log('ğŸ”’ [ìƒëª…êµ¬ì¡°] í™˜ê²½ ì •ë³´:', envInfo);
                    
                    // ì¹´ì¹´ì˜¤ OAuth ë“± HTTPS í•„ìˆ˜ ê¸°ëŠ¥ í™•ì¸
                    const httpsRequired = await window.httpsManager.autoHTTPSUpgrade(['kakao_oauth', 'push_notifications']);
                    if (httpsRequired && !window.httpsManager.isHTTPS()) {
                        // HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì§„í–‰ ì¤‘ - ì—¬ê¸°ì„œ ì¤‘ë‹¨
                        return false;
                    }
                }

                if (!window.firebaseInitializer) {
                    updateSplashStatus('Firebase ì´ˆê¸°í™” ê´€ë¦¬ì ë¡œë“œ ì‹¤íŒ¨', 50);
                    return false;
                }
                
                updateSplashStatus('Firebase ì´ˆê¸°í™” ì¤‘...', 50);
                
                // Firebase ì´ˆê¸°í™” ê´€ë¦¬ìë¥¼ í†µí•œ ì•ˆì „í•œ ì´ˆê¸°í™”
                const success = await window.firebaseInitializer.initializeWithRetry();
                
                if (success) {
                    updateSplashStatus('Firebase ì—°ê²°ë¨', 70);
                    
                    // ì—°ê²° ëª¨ë‹ˆí„°ë§ ì‹œì‘
                    if (window.firebaseConnectionMonitor) {
                        window.firebaseConnectionMonitor.startMonitoring();
                    }
                    
                    return true;
                } else {
                    updateSplashStatus('Firebase ì—°ê²° ì‹¤íŒ¨ - ë¡œì»¬ ëª¨ë“œ', 70);
                    return false;
                }
                
            } catch (error) {
                console.error('âŒ [ìƒëª…êµ¬ì¡°] Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                updateSplashStatus('Firebase ì´ˆê¸°í™” ì˜¤ë¥˜ - ë¡œì»¬ ëª¨ë“œ', 70);
                return false;
            }
        }

        // ì•± ì´ˆê¸°í™” ë° í™”ë©´ ì „í™˜
        async function initializeApp() {
            try {
                updateSplashStatus('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...', 10);
                
                // Firebase ì—°ê²° ëŒ€ê¸°
                updateSplashStatus('Firebase ì—°ê²° ì¤‘...', 30);
                const firebaseReady = await waitForFirebase();
                
                if (firebaseReady && isLoggedIn) {
                    // ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ Firebase ì‚¬ìš©ì ê²€ì¦
                    updateSplashStatus('ë¡œê·¸ì¸ ì •ë³´ í™•ì¸ ì¤‘...', 85);
                    
                    try {
                        const userData = JSON.parse(savedUser);
                        const kakaoId = userData.kakao_id || userData.kakaoId;
                        
                        if (kakaoId && window.storage) {
                            // ìƒˆë¡œìš´ ì´ˆê¸°í™” ì‹œìŠ¤í…œ ì‚¬ìš©
                            await window.storage.waitForInitialization();
                            
                            if (window.storage.isInitialized) {
                                const firebaseUser = await window.storage.getUserByKakaoId(kakaoId);
                                
                                if (!firebaseUser) {
                                    console.log('ğŸ”¥ [ìƒëª…êµ¬ì¡°] Firebaseì— ì‚¬ìš©ì ì—†ìŒ, main.jsì—ì„œ ìë™ ìƒì„±ë¨');
                                    // ìŠ¤í”Œë˜ì‹œì—ì„œëŠ” ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€, main.jsì—ì„œ ì‚¬ìš©ì ìƒì„± ì²˜ë¦¬
                                }
                            } else {
                                console.warn('âš ï¸ [ìƒëª…êµ¬ì¡°] Firebase Storage ì´ˆê¸°í™” ì‹¤íŒ¨ - ë¡œì»¬ ëª¨ë“œë¡œ ì§„í–‰');
                            }
                        }
                    } catch (e) {
                        console.log('Firebase ì‚¬ìš©ì ê²€ì¦ ì‹¤íŒ¨ (ë¬´ì‹œ):', e.message);
                    }
                }
                
                updateSplashStatus(isLoggedIn ? 'ë©”ì¸ í™”ë©´ ì¤€ë¹„ ì¤‘...' : 'ë¡œê·¸ì¸ í™”ë©´ ì¤€ë¹„ ì¤‘...', 95);
                
                // ìµœì†Œ 2ì´ˆ ëŒ€ê¸° (ì‚¬ìš©ì ê²½í—˜)
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                updateSplashStatus('ì™„ë£Œ!', 100);
                
                // í™”ë©´ ì „í™˜
                setTimeout(() => {
                    initializeAuthState();
                    hideSplashScreen();
                }, 500);
                
            } catch (error) {
                console.error('ì•± ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                updateSplashStatus('ì´ˆê¸°í™” ì‹¤íŒ¨ - ê¸°ë³¸ ëª¨ë“œë¡œ ì§„í–‰', 100);
                setTimeout(() => {
                    initializeAuthState();
                    hideSplashScreen();
                }, 1000);
            }
        }

        // ìƒíƒœì— ë”°ë¼ í™”ë©´ ì„¤ì •
        function initializeAuthState() {
            var authContainer = document.getElementById('auth-container');
            var mainApp = document.getElementById('main-app');
            var bottomNav = document.getElementById('bottom-nav');
            
            if (isLoggedIn) {
                // ë¡œê·¸ì¸ëœ ìƒíƒœ: ë©”ì¸ ì•± í‘œì‹œ
                if (authContainer) {
                    authContainer.classList.add('hidden');
                    authContainer.style.display = 'none';
                }
                if (mainApp) {
                    mainApp.classList.remove('hidden');
                    mainApp.classList.add('show');
                    mainApp.style.display = 'block';
                }
                if (bottomNav) {
                    bottomNav.style.display = 'flex';
                }
                console.log('âœ… ë¡œê·¸ì¸ ìƒíƒœ - ë©”ì¸ ì•± í‘œì‹œ');
            } else {
                // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ: ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
                if (authContainer) {
                    authContainer.classList.remove('hidden');
                    authContainer.style.display = 'block';
                }
                if (mainApp) {
                    mainApp.classList.add('hidden');
                    mainApp.classList.remove('show');
                    mainApp.style.display = 'none';
                }
                if (bottomNav) {
                    bottomNav.style.display = 'none';
                }
                console.log('âœ… ë¡œê·¸ì•„ì›ƒ ìƒíƒœ - ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ');
            }
        }
        
        // ìŠ¤í”Œë˜ì‹œ í™”ë©´ ìˆ¨ê¸°ê¸° í•¨ìˆ˜
        function hideSplashScreen() {
            console.log('ğŸš¨ ìŠ¤í”Œë˜ì‹œ ì œê±° ì‹œì‘');
            var splash = document.getElementById('splash-screen');
            if (splash) {
                splash.style.transition = 'opacity 0.5s ease-out';
                splash.style.opacity = '0';
                setTimeout(() => {
                    splash.style.display = 'none';
                    console.log('âœ… ìŠ¤í”Œë˜ì‹œ ìˆ¨ê¹€ ì™„ë£Œ');
                }, 500);
            }
        }

        // ë°°ì§€ í´ë¦¬ì–´ í•¨ìˆ˜ (ì¡°ìš©íˆ ì‹¤í–‰)
        function clearNotificationBadge() {
            console.log('ğŸ”” ì•Œë¦¼ ë°°ì§€ ì¡°ìš©íˆ í´ë¦¬ì–´');
            
            // AndroidBridgeë¥¼ í†µí•œ ë°°ì§€ í´ë¦¬ì–´ë§Œ ì‹¤í–‰ (í† ìŠ¤íŠ¸/ì§„ë™ ì—†ìŒ)
            if (window.AndroidBridge && typeof window.AndroidBridge.clearNotificationBadge === 'function') {
                window.AndroidBridge.clearNotificationBadge();
                console.log('âœ… Android ë°°ì§€ ì¡°ìš©íˆ í´ë¦¬ì–´ ì™„ë£Œ');
            }
            
            // ì•±ì´ í¬ê·¸ë¼ìš´ë“œë¡œ ì˜¬ ë•Œë„ í´ë¦¬ì–´
            if (window.AndroidBridge && typeof window.AndroidBridge.onAppForeground === 'function') {
                window.AndroidBridge.onAppForeground();
                console.log('âœ… ì•± í¬ê·¸ë¼ìš´ë“œ ë°°ì§€ ì¡°ìš©íˆ í´ë¦¬ì–´ ì™„ë£Œ');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°°ì§€ ìë™ í´ë¦¬ì–´
        window.addEventListener('load', () => {
            setTimeout(clearNotificationBadge, 1000); // 1ì´ˆ í›„ ìë™ í´ë¦¬ì–´
        });

        // í¬ì»¤ìŠ¤ ì‹œ ë°°ì§€ í´ë¦¬ì–´  
        window.addEventListener('focus', clearNotificationBadge);

        // ì•± ì‹œì‘
        initializeApp();
    </script>

    <div id="app" class="container">
        <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ -->
        <div id="auth-container" class="hidden">
            <div style="background: linear-gradient(135deg, #74c0fc 0%, #91c3ff 100%); min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 32px;">
                
                <!-- ë¡œê³  ì˜ì—­ -->
                <div style="width: 120px; height: 120px; background: white; border-radius: 60px; display: flex; align-items: center; justify-content: center; margin-bottom: 32px; box-shadow: 0 10px 20px rgba(0,0,0,0.1);">
                    <div style="font-size: 60px; color: #74c0fc;">â¤ï¸</div>
                </div>
                
                <!-- ì•± ì´ë¦„ -->
                <div style="font-size: 32px; font-weight: bold; color: white; margin-bottom: 8px;">lonely-care</div>
                
                <!-- ë¶€ì œëª© -->
                <div style="font-size: 16px; color: rgba(255,255,255,0.8); margin-bottom: 64px;">ì†Œì¤‘í•œ ì‚¬ëŒê³¼ ì—°ê²°ë˜ì–´ ì•ˆì „í•˜ê²Œ</div>
                
                <!-- ë¡œê·¸ì¸ ì¹´ë“œ -->
                <div style="background: white; border-radius: 16px; padding: 32px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); width: 100%; max-width: 320px;">
                    <div style="font-size: 24px; font-weight: bold; color: #74c0fc; text-align: center; margin-bottom: 24px;">ë¡œê·¸ì¸</div>
                    
                    <div style="text-align: center; font-size: 14px; color: #666; line-height: 1.5; margin-bottom: 32px;">
                        lonely-careì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!<br>ì¹´ì¹´ì˜¤ ê³„ì •ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸í•˜ì„¸ìš”.
                    </div>
                    
                    <button id="kakao-login-btn" class="kakao-login-btn">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Cpath fill='%233C1E1E' d='M10 2C5.6 2 2 5.1 2 8.9c0 2.4 1.4 4.5 3.6 5.7l-.8 2.9c-.1.3.2.5.5.4l3.2-2.1c.5.1 1 .1 1.5.1 4.4 0 8-3.1 8-6.9S14.4 2 10 2z'/%3E%3C/svg%3E" alt="ì¹´ì¹´ì˜¤">
                        <span id="login-btn-text">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸</span>
                        <div id="login-progress" style="display: none;">
                            <div class="login-spinner"></div>
                            <span id="login-status">ë¡œê·¸ì¸ ì¤‘...</span>
                        </div>
                        <div id="login-progress-bar" style="display: none; width: 100%; height: 3px; background: rgba(255,255,255,0.3); margin-top: 8px; border-radius: 2px; overflow: hidden;">
                            <div id="login-progress-fill" style="width: 0%; height: 100%; background: #FFFFFF; border-radius: 2px; transition: width 0.3s ease;"></div>
                        </div>
                    </button>
                    
                    <!-- ğŸ§ª ê°œë°œ/í…ŒìŠ¤íŠ¸ìš© ë¡œê·¸ì¸ ë²„íŠ¼ë“¤ -->
                </div>
                
                <!-- ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ -->
                <div style="text-align: center; font-size: 12px; color: rgba(255,255,255,0.6); line-height: 1.4; margin-top: 32px; max-width: 320px;">
                    ë¡œê·¸ì¸í•˜ë©´ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ë°<br>ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì— ë™ì˜í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
                </div>
                
            </div>
        </div>

        <!-- ë©”ì¸ ì•± í™”ë©´ (ë¡œê·¸ì¸ í›„ í‘œì‹œ) -->
        <div id="main-app" class="hidden">
            
            <nav class="bottom-nav" id="bottom-nav">
                <button id="nav-friends" class="nav-item active">
                    <div class="nav-icon">ğŸ‘¥</div>
                    <div class="nav-text">ì¹œêµ¬ ê´€ë¦¬</div>
                </button>
                <button id="nav-status" class="nav-item">
                    <div class="nav-icon">ğŸ“Š</div>
                    <div class="nav-text">ì¹œêµ¬ ìƒíƒœ</div>
                </button>
                <button id="nav-ads" class="nav-item">
                    <div class="nav-icon">ğŸ“¢</div>
                    <div class="nav-text">ê´‘ê³  ë°°ë„ˆ</div>
                </button>
                <button id="nav-notifications" class="nav-item">
                    <div class="nav-icon">ğŸ””</div>
                    <div class="nav-text">ì•Œë¦¼ ì„¤ì •</div>
                </button>
                <button id="nav-profile" class="nav-item">
                    <div class="nav-icon">ğŸ‘¤</div>
                    <div class="nav-text">í”„ë¡œí•„ ì„¤ì •</div>
                </button>
            </nav>

            <main class="app-content">
                <!-- ì¹œêµ¬ ê´€ë¦¬ í˜ì´ì§€ -->
                <div id="friends-page" class="page active">
                    <div class="header">
                        <div class="logo">ì¹œêµ¬ ê´€ë¦¬</div>
                        <div class="tagline">ì´ˆëŒ€ì½”ë“œë¥¼ í†µí•´ ì¹œêµ¬ì™€ ì•ˆì „ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì„±í•˜ì„¸ìš”</div>
                    </div>

                    <!-- í˜„ì¬ ë“±ë¡ëœ ì¹œêµ¬ ëª©ë¡ -->
                    <div id="current-friends-list" class="profile-section friend-list">
                        <h3>ğŸ‘¥ ì¹œêµ¬ ëª©ë¡</h3>
                        <p style="font-size: 14px; color: #666; margin-bottom: 20px;">ë“±ë¡ëœ ì¹œêµ¬ë“¤ì˜ í˜„í™©ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
                        
                        <!-- ğŸš¨ ìƒëª…êµ¬ì¡° ì•±: ê¹œë¹¡ì„ ë°©ì§€ ìŠ¤í”¼ë„ˆ ì»¨í…Œì´ë„ˆ -->
                        <div id="friends-loading-container" style="background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%); padding: 40px; border: 2px solid #cce6ff; border-radius: 12px; margin-bottom: 20px; text-align: center; box-shadow: 0 4px 20px rgba(102, 179, 255, 0.15);">
                            <!-- ğŸ”„ ì•ˆì •ì ì¸ ë¡œë”© ìŠ¤í”¼ë„ˆ -->
                            <div class="stable-loading-spinner">
                                <div style="font-size: 48px; margin-bottom: 20px; animation: smoothSpin 2s linear infinite; color: #66b3ff;">âŸ³</div>
                                <div style="font-size: 18px; font-weight: 600; color: #2563eb; margin-bottom: 8px;">ì¹œêµ¬ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘</div>
                                <div style="font-size: 14px; color: #64748b;">ìƒëª…ì„ êµ¬í•˜ëŠ” ì‹œìŠ¤í…œì„ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
                            </div>
                            
                            <style>
                            @keyframes smoothSpin {
                                0% { transform: rotate(0deg); }
                                100% { transform: rotate(360deg); }
                            }
                            </style>
                        </div>
                    </div>

                    <!-- ì¹œêµ¬ ê´€ë¦¬ í†µí•© ì„¹ì…˜ -->
                    <div class="profile-section">
                        <h3>ğŸ¤ ì¹œêµ¬ ê´€ë¦¬</h3>
                        <p style="font-size: 14px; color: #666; margin-bottom: 20px;">ì´ˆëŒ€ì½”ë“œë¥¼ í†µí•´ ì¹œêµ¬ì™€ ì•ˆì „ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì„±í•˜ì„¸ìš”</p>
                        
                        <!-- ë‚˜ì˜ ì´ˆëŒ€ì½”ë“œ -->
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #e9ecef;">
                            <h4 style="margin: 0 0 10px 0; font-size: 16px; color: #333;">ğŸŸï¸ ë‚˜ì˜ ì´ˆëŒ€ì½”ë“œ</h4>
                            <p style="font-size: 13px; color: #666; margin-bottom: 12px;">ì¹œêµ¬ì—ê²Œ ì´ ì½”ë“œë¥¼ ê³µìœ í•˜ì—¬ ì•ˆì‹¬ì¼€ì–´ ì¹œêµ¬ë¡œ ì´ˆëŒ€í•˜ì„¸ìš”</p>
                            
                            <div class="invite-code-container">
                                <div class="invite-code-display">
                                    <input type="text" id="my-invite-code" readonly placeholder="ì½”ë“œ ìƒì„± ì¤‘...">
                                    <button id="copy-code-btn" class="btn-copy">ğŸ“‹ ë³µì‚¬</button>
                                </div>
                                <button id="generate-code-btn" class="btn btn-secondary" style="margin-top: 10px;">ğŸ”„ ìƒˆ ì½”ë“œ ìƒì„±</button>
                            </div>
                        </div>
                        
                        <!-- ì¹œêµ¬ ì´ˆëŒ€ì½”ë“œ ì…ë ¥ -->
                        <div style="background: #fff; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="margin: 0 0 10px 0; font-size: 16px; color: #333;">â• ì¹œêµ¬ ì¶”ê°€</h4>
                            <p style="font-size: 13px; color: #666; margin-bottom: 12px;">ì¹œêµ¬ë¡œë¶€í„° ë°›ì€ ì´ˆëŒ€ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
                            
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="text" id="friend-invite-code" placeholder="ì´ˆëŒ€ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ABC123)" style="margin-bottom: 10px;">
                                <button id="add-friend-btn" class="btn">ğŸ‘¥ ì¹œêµ¬ ì¶”ê°€</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì¹œêµ¬ ìƒíƒœ í˜ì´ì§€ -->
                <div id="status-page" class="page">
                    <div class="header">
                        <div class="logo">ì¹œêµ¬ ìƒíƒœ</div>
                        <div class="tagline">ì¹œêµ¬ë“¤ì˜ ì‹¤ì‹œê°„ ì•ˆì „ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”</div>
                    </div>

                    <!-- ìƒíƒœ ì•ˆë‚´ -->
                    <div class="emergency-info">
                        <strong>ğŸš¨ ìƒíƒœ ì•ˆë‚´</strong>
                        <div style="margin-top: 8px; font-size: 14px;">
                            <div>ğŸŸ¢ ì •ìƒ: <span id="normal-time-display">24ì‹œê°„</span> ì´ë‚´ í™œë™</div>
                            <div style="color: #ffc107;">ğŸŸ¡ ì£¼ì˜: <span id="warning-time-display">24ì‹œê°„</span> ë¬´ì‘ë‹µ</div>
                            <div style="color: #fd7e14;">ğŸŸ  ê²½ê³ : <span id="danger-time-display">48ì‹œê°„</span> ë¬´ì‘ë‹µ</div>
                            <div style="color: #dc3545;">ğŸ”´ ìœ„í—˜: <span id="emergency-time-display">72ì‹œê°„</span> ë¬´ì‘ë‹µ</div>
                        </div>
                    </div>

                    <!-- ìƒíƒœë³„ í•„í„° íƒ­ (â˜¶ ëª¨ì–‘ ë ˆì´ì•„ì›ƒ) -->
                    <div class="status-filter-tabs">
                        <!-- ì „ì²´ ë²„íŠ¼ - ìœ„ìª½ì— ê¸¸ê²Œ -->
                        <button class="status-tab active" data-status="all">
                            ğŸ“Š ì „ì²´ <span id="count-all" class="status-count">0</span>
                        </button>
                        
                        <!-- ë‚˜ë¨¸ì§€ 4ê°œ ë²„íŠ¼ - ì•„ë˜ìª½ì— ê°™ì€ í¬ê¸°ë¡œ -->
                        <div class="status-tabs-row">
                            <button class="status-tab" data-status="normal">
                                ğŸŸ¢ ì •ìƒ <span id="count-normal" class="status-count">0</span>
                            </button>
                            <button class="status-tab" data-status="warning">
                                ğŸŸ¡ ì£¼ì˜ <span id="count-warning" class="status-count">0</span>
                            </button>
                            <button class="status-tab" data-status="danger">
                                ğŸŸ  ê²½ê³  <span id="count-danger" class="status-count">0</span>
                            </button>
                            <button class="status-tab" data-status="emergency">
                                ğŸ”´ ìœ„í—˜ <span id="count-emergency" class="status-count">0</span>
                            </button>
                        </div>
                    </div>


                    <!-- ì¹œêµ¬ ìƒíƒœ ëª©ë¡ -->
                    <div id="friends-status-container">
                        <div id="friends-status">
                            <p style="text-align: center; color: #999; padding: 40px;">ë“±ë¡ëœ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ì¹œêµ¬ ê´€ë¦¬ì—ì„œ ì¹œêµ¬ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>

                <!-- ê´‘ê³  ë°°ë„ˆ í˜ì´ì§€ -->
                <div id="ads-page" class="page">
                    <div class="header">
                        <div class="logo">ê´‘ê³  ë°°ë„ˆ</div>
                        <div class="tagline">ìƒí™œì— ë„ì›€ì´ ë˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”</div>
                    </div>

                    <div class="tabs">
                        <button class="tab active" data-tab="insurance">ë³´í—˜</button>
                        <button class="tab" data-tab="funeral">ìƒì¡°</button>
                        <button class="tab" data-tab="lawyer">ë³€í˜¸ì‚¬</button>
                    </div>
                    <div id="ad-content" class="ad-content">
                        <div class="ad-empty-container">
                            <div class="ad-empty-icon">ğŸ“­</div>
                            <div class="ad-empty-title">ë“±ë¡ëœ ê´‘ê³ ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                            <div class="ad-empty-description">ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ê´‘ê³ ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>
                        </div>
                    </div>
                </div>

                <!-- ì•Œë¦¼ ì„¤ì • í˜ì´ì§€ -->
                <div id="notifications-page" class="page">
                    <div class="header">
                        <div class="logo">ì•Œë¦¼ ì„¤ì •</div>
                        <div class="tagline">í•„ìš”í•œ ì•Œë¦¼ë§Œ ì„ íƒí•˜ì—¬ ë°›ìœ¼ì„¸ìš”</div>
                    </div>

                    <div class="notification-settings-main-container">
                        <div class="notification-settings-header">
                            <h3 class="notification-settings-title">ğŸ“³ ì•Œë¦¼ ì„¤ì •</h3>
                        </div>
                        
                        <div class="notification-setting">
                            <div class="setting-info">
                                <div class="setting-title">í‘¸ì‹œ ì•Œë¦¼ í—ˆìš©</div>
                                <div class="setting-description">ì•±ì˜ ëª¨ë“  ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="push-notifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="notification-setting">
                            <div class="setting-info">
                                <div class="setting-title">ì¹œêµ¬ ìƒíƒœ ì•Œë¦¼</div>
                                <div class="setting-description">ì¹œêµ¬ë“¤ì˜ í™œë™ ìƒíƒœ ë³€í™”ë¥¼ ì•Œë¦¼</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="friend-notifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="notification-setting">
                            <div class="setting-info">
                                <div class="setting-title">ì£¼ì˜ ì•Œë¦¼ (<span id="warning-setting-time">24ì‹œê°„</span> ë¬´ì‘ë‹µ)</div>
                                <div class="setting-description">ì¹œêµ¬ê°€ ì„¤ì •ëœ ì‹œê°„ ë™ì•ˆ ì‘ë‹µí•˜ì§€ ì•Šì„ ë•Œ</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="warning-notifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="notification-setting">
                            <div class="setting-info">
                                <div class="setting-title">ê²½ê³  ì•Œë¦¼ (<span id="danger-setting-time">48ì‹œê°„</span> ë¬´ì‘ë‹µ)</div>
                                <div class="setting-description">ì¹œêµ¬ê°€ ì„¤ì •ëœ ì‹œê°„ ë™ì•ˆ ì‘ë‹µí•˜ì§€ ì•Šì„ ë•Œ</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="danger-notifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="notification-setting">
                            <div class="setting-info">
                                <div class="setting-title">ìœ„í—˜ ì•Œë¦¼ (<span id="emergency-setting-time">72ì‹œê°„</span> ë¬´ì‘ë‹µ)</div>
                                <div class="setting-description">ì¹œêµ¬ê°€ ì„¤ì •ëœ ì‹œê°„ ë™ì•ˆ ì‘ë‹µí•˜ì§€ ì•Šì„ ë•Œ</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="emergency-notifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="notification-setting emergency-consent-setting">
                            <div class="setting-info">
                                <div class="setting-title">ğŸš¨ ê¸´ê¸‰ìƒí™© ìë™ ì‹ ê³  ë™ì˜</div>
                                <div class="setting-description">72ì‹œê°„ ë¬´ì‘ë‹µ ì‹œ 119ì— ìë™ ì‹ ê³ í•©ë‹ˆë‹¤</div>
                                <div class="emergency-warning">
                                    âš ï¸ ìƒëª… êµ¬ì¡°ë¥¼ ìœ„í•œ í•„ìˆ˜ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ë™ì˜í•˜ì§€ ì•Šìœ¼ë©´ ê³ ë…ì‚¬ ì˜ˆë°© íš¨ê³¼ê°€ ì œí•œë©ë‹ˆë‹¤.
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="emergency-contact-consent" checked>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="settings-save-button">
                            <button class="btn-save" id="save-notification-settings">ì„¤ì • ì €ì¥</button>
                        </div>
                    </div>


                    <div class="recent-notifications-container">
                        <div class="recent-notifications-header">
                            <h3 class="recent-notifications-title">ğŸ“‹ ìµœê·¼ ì•Œë¦¼</h3>
                        </div>
                        <div class="recent-notifications-empty">
                            <span class="empty-icon">ğŸ“­</span>
                            <p class="empty-message">ìµœê·¼ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
                            <p class="empty-description">ìƒˆë¡œìš´ ì•Œë¦¼ì´ ë„ì°©í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>

                <!-- í”„ë¡œí•„ ì„¤ì • í˜ì´ì§€ -->
                <div id="profile-page" class="page">
                    <div class="header">
                        <div class="logo">í”„ë¡œí•„ ì„¤ì •</div>
                        <div class="tagline">ì‘ê¸‰ìƒí™© ì‹œ ì‹ ì†í•œ ëŒ€ì‘ì„ ìœ„í•´ ìƒì„¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
                    </div>

                    <div class="emergency-info">
                        <strong>âš ï¸ ì¤‘ìš” ì•ˆë‚´</strong>
                        <div style="margin-top: 8px; font-size: 14px; line-height: 1.5;">
                            ì‘ê¸‰ìƒí™© ì‹œ êµ­ê°€ê¸°ê´€(119)ì— ì‹ ì†íˆ<br>
                            ì •ë³´ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ ê°€ëŠ¥í•œ ìƒì„¸í•˜ê²Œ<br>
                            ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
                        </div>
                    </div>

                    <form id="profile-form">
                        <!-- ê¸°ë³¸ ì •ë³´ -->
                        <div class="profile-section">
                            <h3>ğŸ‘¤ ê¸°ë³¸ ì •ë³´</h3>
                            
                            <!-- í”„ë¡œí•„ ì‚¬ì§„ -->
                            <div class="form-group">
                                <label>í”„ë¡œí•„ ì‚¬ì§„</label>
                                <div style="text-align: center; margin: 15px 0; display: flex; flex-direction: column; align-items: center;">
                                    <img id="profile-pic-preview" src="" alt="í”„ë¡œí•„ ì‚¬ì§„" style="width: 120px; height: 120px; border-radius: 50%; border: 3px solid #ddd; object-fit: cover; display: none; margin: 0 auto;">
                                    <div id="profile-pic-placeholder" style="width: 120px; height: 120px; border-radius: 50%; border: 3px solid #ddd; background: #f0f0f0; display: flex; align-items: center; justify-content: center; margin: 0 auto; color: #999; font-size: 14px;">ì‚¬ì§„ ì—†ìŒ</div>
                                </div>
                                <div class="file-upload" onclick="document.getElementById('profile-photo-input').click()" style="margin-top: 10px;">
                                    ğŸ“· í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ
                                </div>
                                <input type="file" id="profile-photo-input" accept="image/*" style="display: none;">
                                <p style="font-size: 12px; color: #999; text-align: center; margin: 5px 0 0 0;">ì¹´ì¹´ì˜¤ í”„ë¡œí•„ ì‚¬ì§„ ë˜ëŠ” ìƒˆ ì‚¬ì§„ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                            </div>
                            
                            <div class="form-group">
                                <label for="profile-name">ì´ë¦„ *</label>
                                <input type="text" id="profile-name" placeholder="ì‹¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                            </div>
                            <div class="form-group">
                                <label for="profile-phone">ì „í™”ë²ˆí˜¸ *</label>
                                <input type="tel" id="profile-phone" placeholder="010-0000-0000" required>
                            </div>
                            <div class="form-group">
                                <label for="profile-birth">ìƒë…„ì›”ì¼</label>
                                <input type="date" id="profile-birth">
                            </div>
                            <div class="form-group">
                                <label for="profile-gender">ì„±ë³„</label>
                                <select id="profile-gender">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="male">ë‚¨ì„±</option>
                                    <option value="female">ì—¬ì„±</option>
                                </select>
                            </div>
                        </div>

                        <!-- ê±°ì£¼ì§€ ì •ë³´ -->
                        <div class="profile-section">
                            <h3>ğŸ  ê±°ì£¼ì§€ ì •ë³´</h3>
                            <div class="form-group">
                                <label for="profile-address">ì£¼ì†Œ *</label>
                                <input type="text" id="profile-address" placeholder="ì‹œ/ë„, êµ¬/êµ°ì„ í¬í•¨í•œ ì£¼ì†Œ" required>
                            </div>
                            <div class="form-group">
                                <label for="profile-detail-address">ìƒì„¸ì£¼ì†Œ</label>
                                <input type="text" id="profile-detail-address" placeholder="ë™/í˜¸ìˆ˜, ê±´ë¬¼ëª… ë“±">
                            </div>
                            <div class="form-group">
                                <label for="profile-postal">ìš°í¸ë²ˆí˜¸</label>
                                <input type="text" id="profile-postal" placeholder="12345">
                            </div>
                        </div>

                        <!-- ë¹„ìƒ ì—°ë½ì²˜ -->
                        <div class="profile-section">
                            <h3>ğŸ“ ë¹„ìƒ ì—°ë½ì²˜</h3>
                            <div class="form-group">
                                <label for="emergency-contact1">ë¹„ìƒì—°ë½ì²˜ 1 (ê°€ì¡±)</label>
                                <input type="tel" id="emergency-contact1" placeholder="010-0000-0000">
                            </div>
                            <div class="form-group">
                                <label for="emergency-name1">ê´€ê³„</label>
                                <input type="text" id="emergency-name1" placeholder="ì˜ˆ: ë¶€ëª¨ë‹˜, í˜•ì œìë§¤">
                            </div>
                            <div class="form-group">
                                <label for="emergency-contact2">ë¹„ìƒì—°ë½ì²˜ 2</label>
                                <input type="tel" id="emergency-contact2" placeholder="010-0000-0000">
                            </div>
                            <div class="form-group">
                                <label for="emergency-name2">ê´€ê³„</label>
                                <input type="text" id="emergency-name2" placeholder="ì˜ˆ: ì¹œêµ¬, ë™ë£Œ">
                            </div>
                        </div>

                        <!-- ì˜ë£Œ ì •ë³´ -->
                        <div class="profile-section">
                            <h3>ğŸ¥ ì˜ë£Œ ì •ë³´</h3>
                            <div class="form-group">
                                <label for="blood-type">í˜ˆì•¡í˜•</label>
                                <select id="blood-type">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="A+">Aí˜• Rh+</option>
                                    <option value="A-">Aí˜• Rh-</option>
                                    <option value="B+">Bí˜• Rh+</option>
                                    <option value="B-">Bí˜• Rh-</option>
                                    <option value="AB+">ABí˜• Rh+</option>
                                    <option value="AB-">ABí˜• Rh-</option>
                                    <option value="O+">Oí˜• Rh+</option>
                                    <option value="O-">Oí˜• Rh-</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="medical-conditions">ì§€ë³‘/ë³µìš©ì•½ë¬¼</label>
                                <textarea id="medical-conditions" rows="3" placeholder="ë‹¹ë‡¨, ê³ í˜ˆì•• ë“± ì§€ë³‘ì´ë‚˜ ì •ê¸° ë³µìš© ì•½ë¬¼ì´ ìˆë‹¤ë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="allergies">ì•Œë ˆë¥´ê¸°</label>
                                <input type="text" id="allergies" placeholder="ì•½ë¬¼/ìŒì‹ ì•Œë ˆë¥´ê¸°ê°€ ìˆë‹¤ë©´ ì…ë ¥í•˜ì„¸ìš”">
                            </div>
                        </div>

                        <!-- ê¸°íƒ€ ì •ë³´ -->
                        <div class="profile-section">
                            <h3>ğŸ“‹ ê¸°íƒ€ ì •ë³´</h3>
                            <div class="form-group">
                                <label for="workplace">ì§ì¥/í•™êµ</label>
                                <input type="text" id="workplace" placeholder="ì§ì¥ì´ë‚˜ í•™êµëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>
                            <div class="form-group">
                                <label for="special-notes">íŠ¹ì´ì‚¬í•­</label>
                                <textarea id="special-notes" rows="3" placeholder="ì‘ê¸‰ìƒí™© ì‹œ ì•Œì•„ì•¼ í•  íŠ¹ë³„í•œ ì‚¬í•­ì´ ìˆë‹¤ë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            </div>
                        </div>

                        <!-- ì˜ì •ì‚¬ì§„ (ì„ íƒì‚¬í•­) -->
                        <div class="profile-section">
                            <h3>ğŸ–¼ï¸ ì˜ì •ì‚¬ì§„ (ì„ íƒì‚¬í•­)</h3>
                            <div class="form-group">
                                <label>ì˜ì •ì‚¬ì§„ ì—…ë¡œë“œ</label>
                                <div style="text-align: center; margin: 15px 0; display: flex; flex-direction: column; align-items: center;">
                                    <img id="memorial-pic-preview" src="" alt="ì˜ì •ì‚¬ì§„" style="width: 120px; height: 120px; border: 2px solid #ddd; object-fit: cover; border-radius: 8px; display: none; margin: 0 auto;">
                                    <div id="memorial-pic-placeholder" style="width: 120px; height: 120px; border: 2px solid #ddd; background: #f0f0f0; display: flex; align-items: center; justify-content: center; margin: 0 auto; color: #999; font-size: 14px; border-radius: 8px;">ì‚¬ì§„ ì—†ìŒ</div>
                                </div>
                                <div class="file-upload" onclick="document.getElementById('memorial-photo-input').click()">
                                    ğŸ“· ì˜ì •ì‚¬ì§„ ì—…ë¡œë“œ
                                </div>
                                <input type="file" id="memorial-photo-input" accept="image/*" style="display: none;">
                            </div>
                        </div>


                        <!-- ğŸ’³ êµ¬ë… ê´€ë¦¬ ì„¹ì…˜ -->
                        <div class="profile-section">
                            <h3>ğŸ’³ êµ¬ë… ê´€ë¦¬</h3>
                            <div id="subscription-management-container">
                                <div class="current-subscription">
                                    <h4>í˜„ì¬ í”Œëœ: <span id="current-plan-name">ë¬´ë£Œ í”Œëœ</span></h4>
                                    <div class="subscription-details">
                                        <p id="subscription-details-text">ì¹œêµ¬ 1ëª…ê¹Œì§€ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥</p>
                                        <p id="subscription-expiry" style="display: none;">ë§Œë£Œì¼: <span id="expiry-date"></span></p>
                                    </div>
                                </div>
                                
                                <div class="subscription-actions">
                                    <button id="basic-upgrade-btn" class="btn subscription-btn" style="background: #17a2b8; color: white;">
                                        ğŸš€ ë² ì´ì§ í”Œëœ ì—…ê·¸ë ˆì´ë“œ (ì›” 2,000ì›)
                                    </button>
                                    <button id="premium-upgrade-btn" class="btn subscription-btn" style="background: #ffc107; color: #000;">
                                        â­ í”„ë¦¬ë¯¸ì—„ í”Œëœ ì—…ê·¸ë ˆì´ë“œ (ì›” 5,000ì›)
                                    </button>
                                    <button id="auto-renew-toggle-btn" class="btn subscription-btn" style="background: #28a745; color: white; display: none;">
                                        ğŸ”„ ìë™ê°±ì‹  ì„¤ì •
                                    </button>
                                    <button id="cancel-subscription-btn" class="btn subscription-btn" style="background: #dc3545; color: white; display: none;">
                                        ğŸš« êµ¬ë… í•´ì§€
                                    </button>
                                    <button id="manage-subscription-btn" class="btn subscription-btn" style="background: #6c757d; color: white;">
                                        âš™ï¸ êµ¬ë… ê´€ë¦¬
                                    </button>
                                </div>
                                
                                <div class="plan-comparison" style="margin-top: 20px;">
                                    <h4>í”Œëœ ë¹„êµ</h4>
                                    <div class="plans-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 10px;">
                                        <div class="plan-card" style="border: 2px solid #ddd; padding: 15px; border-radius: 8px; text-align: center;">
                                            <h5>ë¬´ë£Œ í”Œëœ</h5>
                                            <p class="price">0ì›/ì›”</p>
                                            <ul style="list-style: none; padding: 0; font-size: 14px;">
                                                <li>âœ“ ì¹œêµ¬ 1ëª… ëª¨ë‹ˆí„°ë§</li>
                                                <li>âœ“ ê¸°ë³¸ ì•Œë¦¼</li>
                                                <li>âœ“ 24/48/72ì‹œê°„ ì•Œë¦¼</li>
                                            </ul>
                                        </div>
                                        <div class="plan-card" style="border: 2px solid #17a2b8; padding: 15px; border-radius: 8px; text-align: center;">
                                            <h5>ë² ì´ì§ í”Œëœ</h5>
                                            <p class="price">2,000ì›/ì›”</p>
                                            <ul style="list-style: none; padding: 0; font-size: 14px;">
                                                <li>âœ“ ì¹œêµ¬ 3ëª… ëª¨ë‹ˆí„°ë§</li>
                                                <li>âœ“ ìš°ì„ ìˆœìœ„ ì•Œë¦¼</li>
                                                <li>âœ“ ìƒì„¸ ìƒíƒœ ë¦¬í¬íŠ¸</li>
                                                <li>âœ“ ì´ë©”ì¼/SMS ì•Œë¦¼</li>
                                            </ul>
                                        </div>
                                        <div class="plan-card" style="border: 2px solid #ffc107; padding: 15px; border-radius: 8px; text-align: center;">
                                            <h5>í”„ë¦¬ë¯¸ì—„ í”Œëœ</h5>
                                            <p class="price">5,000ì›/ì›”</p>
                                            <ul style="list-style: none; padding: 0; font-size: 14px;">
                                                <li>âœ“ ì¹œêµ¬ 10ëª… ëª¨ë‹ˆí„°ë§</li>
                                                <li>âœ“ ìµœìš°ì„  ì•Œë¦¼</li>
                                                <li>âœ“ ìƒì„¸ ë¶„ì„ ë¦¬í¬íŠ¸</li>
                                                <li>âœ“ ëª¨ë“  ì•Œë¦¼ ì±„ë„</li>
                                                <li>âœ“ ê°€ì¡± ê³µìœ  ê¸°ëŠ¥</li>
                                                <li>âœ“ ì‘ê¸‰ ì—°ë½ë§ ìë™ ì—°ê²°</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn" style="margin-top: 30px;">í”„ë¡œí•„ ì €ì¥</button>
                        <button type="button" class="btn btn-danger" id="logout-profile-btn" style="margin-top: 10px; margin-bottom: 20px;">ë¡œê·¸ì•„ì›ƒ</button>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <!-- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì´ˆê¸°í™” -->
    <script>
        // Firebase ê¸°ë°˜ìœ¼ë¡œ ì™„ì „ ì „í™˜ - Supabase ì™„ì „ ì œê±°

        // ğŸ”’ ë³´ì•ˆ ê°•í™”ëœ ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™” (í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©)
        if (typeof Kakao !== 'undefined') {
            try {
                // í™˜ê²½ë³€ìˆ˜ì—ì„œ ì¹´ì¹´ì˜¤ í‚¤ ê°€ì ¸ì˜¤ê¸° (ë³´ì•ˆ ê°•í™”)
                const kakaoKey = window.ENV_KAKAO_JAVASCRIPT_KEY || 
                                (window.getSecureEnv && window.getSecureEnv().getConfig('kakao.javascriptKey')) ||
                                'dd74fd58abbb75eb58df11ecc92d6727'; // fallback (í˜¸í™˜ì„±)
                
                console.log('ğŸ”’ ì¹´ì¹´ì˜¤ í‚¤ ë¡œë“œ:', kakaoKey ? 'âœ… í™˜ê²½ë³€ìˆ˜ì—ì„œ ë¡œë“œë¨' : 'âš ï¸ fallback í‚¤ ì‚¬ìš©');
                
                Kakao.init(kakaoKey);
                console.log('âœ… ë³´ì•ˆ ê°•í™”ëœ Kakao SDK ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ Kakao SDK ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                // ìƒëª…êµ¬ì¡° ì•±ì´ë¯€ë¡œ fallback ì‹œë„
                try {
                    Kakao.init('dd74fd58abbb75eb58df11ecc92d6727');
                    console.warn('âš ï¸ Fallback ì¹´ì¹´ì˜¤ í‚¤ë¡œ ì´ˆê¸°í™” ì„±ê³µ');
                } catch (fallbackError) {
                    console.error('âŒ Fallback ì´ˆê¸°í™”ë„ ì‹¤íŒ¨:', fallbackError);
                }
            }
        }

        // ë¡œê·¸ì¸ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLoginProgress(step, progress = 0, message = '') {
            const btnText = document.getElementById('login-btn-text');
            const loginProgress = document.getElementById('login-progress');
            const loginStatus = document.getElementById('login-status');
            const progressBar = document.getElementById('login-progress-bar');
            const progressFill = document.getElementById('login-progress-fill');
            const kakaoBtn = document.getElementById('kakao-login-btn');
            
            if (!btnText || !loginProgress || !loginStatus || !progressBar || !progressFill || !kakaoBtn) return;

            switch(step) {
                case 'start':
                    kakaoBtn.disabled = true;
                    btnText.style.display = 'none';
                    loginProgress.style.display = 'flex';
                    progressBar.style.display = 'block';
                    loginStatus.textContent = 'ì¹´ì¹´ì˜¤ SDK í™•ì¸ ì¤‘...';
                    progressFill.style.width = '10%';
                    break;
                    
                case 'sdk-check':
                    loginStatus.textContent = 'ì¹´ì¹´ì˜¤ SDK ë¡œë”© ì¤‘...';
                    progressFill.style.width = '25%';
                    break;
                    
                case 'native-check':
                    loginStatus.textContent = 'ì¹´ì¹´ì˜¤í†¡ ì•± í™•ì¸ ì¤‘...';
                    progressFill.style.width = '50%';
                    break;
                    
                case 'login-attempt':
                    loginStatus.textContent = 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹œë„ ì¤‘...';
                    progressFill.style.width = '75%';
                    break;
                    
                case 'web-fallback':
                    loginStatus.textContent = 'ì›¹ ë¡œê·¸ì¸ìœ¼ë¡œ ì „í™˜ ì¤‘...';
                    progressFill.style.width = '85%';
                    break;
                    
                case 'success':
                    loginStatus.textContent = 'ë¡œê·¸ì¸ ì„±ê³µ! ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™ ì¤‘...';
                    progressFill.style.width = '100%';
                    break;
                    
                case 'error':
                    kakaoBtn.disabled = false;
                    btnText.style.display = 'inline';
                    loginProgress.style.display = 'none';
                    progressBar.style.display = 'none';
                    progressFill.style.width = '0%';
                    break;
                    
                case 'custom':
                    loginStatus.textContent = message;
                    progressFill.style.width = progress + '%';
                    break;
            }
            
            console.log(`ğŸ”„ ë¡œê·¸ì¸ ì§„í–‰: ${step} - ${message || loginStatus.textContent} (${progress}%)`);
        }

        // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í•¨ìˆ˜ (ì¤‘ë³µ ë°©ì§€ ê°•í™”)
        async function performKakaoLogin() {
            console.log('ğŸ” ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹œë„ ì‹œì‘...');
            
            // ì´ë¯¸ ì„±ê³µí•œ ê²½ìš° ì¤‘ë³µ ë¡œê·¸ì¸ ë°©ì§€
            if (window._kakaoLoginSuccess || window._kakaoLoginProcessing) {
                console.log('âš ï¸ ì´ë¯¸ ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ì´ê±°ë‚˜ ì„±ê³µí•¨ - ì¤‘ë³µ ë°©ì§€');
                return;
            }
            
            // ë²„íŠ¼ ë¹„í™œì„±í™”ë§Œ ì¦‰ì‹œ ì²˜ë¦¬
            const kakaoBtn = document.getElementById('kakao-login-btn');
            if (kakaoBtn) kakaoBtn.disabled = true;
            
            try {
                // ğŸš¨ ìƒëª…êµ¬ì¡° ì•± ìµœì í™”: ì¦‰ì‹œ ë¡œê·¸ì¸ ì‹œë„
                if (window.kakaoAuthStandalone && typeof window.kakaoAuthStandalone.login === 'function') {
                    console.log('âœ… kakao-auth-standalone ì‚¬ìš© - ì¦‰ì‹œ ì‹¤í–‰');
                    const result = await window.kakaoAuthStandalone.login();
                    console.log('âœ… ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì„±ê³µ:', result);
                    
                } else if (window.Kakao && window.Kakao.Auth) {
                    // Kakao SDK ì§ì ‘ ì‚¬ìš© (ë°±ì—…)
                    console.log('âœ… Kakao SDK ì§ì ‘ ì‚¬ìš©');
                    
                    await new Promise((resolve, reject) => {
                        window.Kakao.Auth.login({
                            success: function(authObj) {
                                console.log('âœ… ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì„±ê³µ');
                                window.Kakao.API.request({
                                    url: '/v2/user/me',
                                    success: function(res) {
                                        const userInfo = {
                                            id: res.id,
                                            kakao_id: res.id,
                                            name: res.properties?.nickname || 'ì‚¬ìš©ì',
                                            email: res.kakao_account?.email || `${res.id}@kakao.com`,
                                            profile_image: res.properties?.profile_image || ''
                                        };
                                        localStorage.setItem('currentUser', JSON.stringify(userInfo));
                                        localStorage.setItem('isLoggedIn', 'true');
                                        window.location.reload();
                                        resolve(userInfo);
                                    },
                                    fail: reject
                                });
                            },
                            fail: reject
                        });
                    });
                    
                } else {
                    // OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ ë°©ì‹ (ìµœí›„ì˜ ìˆ˜ë‹¨)
                    console.log('âš ï¸ OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ ë°©ì‹ ì‚¬ìš©');
                    const CLIENT_ID = 'dd74fd58abbb75eb58df11ecc92d6727';
                    const REDIRECT_URI = window.location.origin + '/oauth.html';
                    const kakaoAuthUrl = `https://kauth.kakao.com/oauth/authorize?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=code`;
                    window.location.href = kakaoAuthUrl;
                }
            } catch (error) {
                console.error('âŒ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                if (kakaoBtn) kakaoBtn.disabled = false;
                alert('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // Android ë„¤ì´í‹°ë¸Œ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì„±ê³µ ì½œë°±
        window.onKakaoLoginSuccess = function(userInfo) {
            console.log('Native login success');
            
            // íƒ€ì„ì•„ì›ƒ í•´ì œ
            if (window._kakaoNativeLoginTimeout) {
                clearTimeout(window._kakaoNativeLoginTimeout);
                window._kakaoNativeLoginTimeout = null;
            }
            
            // ê¸°íƒ€ íƒ€ì„ì•„ì›ƒë“¤ í•´ì œ (ES5 ë°©ì‹)
            if (window._kakaoLoginTimeout) {
                clearTimeout(window._kakaoLoginTimeout);
                window._kakaoLoginTimeout = null;
            }
            if (window._kakaoRetryTimeout) {
                clearTimeout(window._kakaoRetryTimeout);
                window._kakaoRetryTimeout = null;
            }
            if (window._authTimeout) {
                clearTimeout(window._authTimeout);
                window._authTimeout = null;
            }
            
            // ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
            if (window._kakaoLoginProcessing) {
                console.log('Already processing');
                return;
            }
            window._kakaoLoginProcessing = true;
            
            // ì‚¬ìš©ì ì •ë³´ ì €ì¥
            if (userInfo && userInfo.kakao_id) {
                localStorage.setItem('currentUser', JSON.stringify(userInfo));
                localStorage.setItem('isLoggedIn', 'true');
                console.log('Saved to storage');
                
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                setTimeout(function() {
                    window.location.reload();
                }, 300);
            } else {
                console.error('Invalid user info');
                window._kakaoLoginProcessing = false;
            }
        };
        
        // Android ë„¤ì´í‹°ë¸Œ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì˜¤ë¥˜ ì½œë°±
        window.onKakaoLoginError = function(errorMessage) {
            console.error('âŒ Android ë„¤ì´í‹°ë¸Œ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì˜¤ë¥˜:', errorMessage);
            
            // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
            const kakaoBtn = document.getElementById('kakao-login-btn');
            if (kakaoBtn) kakaoBtn.disabled = false;
            
            // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
            if (!errorMessage.includes('cancelled') && !errorMessage.includes('ì·¨ì†Œ')) {
                alert('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        };

        // ê¸´ê¸‰ ë¡œê·¸ì¸ ì˜µì…˜ í‘œì‹œ
        function showEmergencyLoginOption() {
            console.log('ğŸš¨ ê¸´ê¸‰ ë¡œê·¸ì¸ ì˜µì…˜ í‘œì‹œ');
            
            // ì¦‰ì‹œ ê¸´ê¸‰ ë¡œê·¸ì¸ í™œì„±í™” (ìƒëª… êµ¬ì¡° ìš°ì„ )
            if (window.emergencyLogin && typeof window.emergencyLogin.activate === 'function') {
                console.log('ğŸš¨ ìƒëª… êµ¬ì¡° ìš°ì„  - ê¸´ê¸‰ ë¡œê·¸ì¸ ì¦‰ì‹œ í™œì„±í™”');
                window.emergencyLogin.activate();
            } else {
                console.error('âŒ ê¸´ê¸‰ ë¡œê·¸ì¸ ì‹œìŠ¤í…œì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                // ì§ì ‘ ê¸´ê¸‰ ë¡œê·¸ì¸ UI ìƒì„±
                createEmergencyLoginDirectly();
            }
        }

        // ì§ì ‘ ê¸´ê¸‰ ë¡œê·¸ì¸ UI ìƒì„± (ë°±ì—… ë°©ë²•)
        function createEmergencyLoginDirectly() {
            console.log('ğŸš¨ ì§ì ‘ ê¸´ê¸‰ ë¡œê·¸ì¸ UI ìƒì„±');
            
            const emergencyContainer = document.createElement('div');
            emergencyContainer.id = 'emergency-login-container-direct';
            emergencyContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            `;

            emergencyContainer.innerHTML = `
                <div style="
                    background: white;
                    padding: 40px;
                    border-radius: 20px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                ">
                    <div style="
                        background: #FF6B6B;
                        color: white;
                        padding: 15px;
                        border-radius: 10px;
                        margin-bottom: 20px;
                        font-weight: bold;
                        font-size: 16px;
                    ">
                        ğŸš¨ ìƒëª… êµ¬ì¡° ê¸´ê¸‰ ì ‘ê·¼
                    </div>
                    
                    <h2 style="
                        color: #2C3E50;
                        margin-bottom: 10px;
                        font-size: 24px;
                    ">Lonely Care</h2>
                    
                    <p style="
                        color: #7F8C8D;
                        margin-bottom: 30px;
                        line-height: 1.6;
                        font-size: 14px;
                    ">
                        ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì— ë¬¸ì œê°€ ìˆì–´ ê¸´ê¸‰ ì ‘ê·¼ ëª¨ë“œë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.<br>
                        <strong style="color: #E74C3C;">ìƒëª…ì„ êµ¬í•˜ëŠ” ì„œë¹„ìŠ¤ì´ë¯€ë¡œ ì¦‰ì‹œ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</strong>
                    </p>

                    <form id="emergency-login-form-direct">
                        <input 
                            type="text" 
                            id="emergency-name-direct" 
                            placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
                            required
                            style="
                                width: 100%;
                                padding: 15px;
                                border: 2px solid #E0E0E0;
                                border-radius: 10px;
                                font-size: 16px;
                                margin-bottom: 15px;
                                box-sizing: border-box;
                            "
                        />
                        
                        <input 
                            type="tel" 
                            id="emergency-phone-direct" 
                            placeholder="ì „í™”ë²ˆí˜¸ (010-1234-5678)"
                            required
                            style="
                                width: 100%;
                                padding: 15px;
                                border: 2px solid #E0E0E0;
                                border-radius: 10px;
                                font-size: 16px;
                                margin-bottom: 20px;
                                box-sizing: border-box;
                            "
                        />

                        <button 
                            type="submit"
                            style="
                                width: 100%;
                                padding: 15px;
                                background: #27AE60;
                                color: white;
                                border: none;
                                border-radius: 10px;
                                font-size: 18px;
                                font-weight: bold;
                                cursor: pointer;
                            "
                        >
                            ğŸ›¡ï¸ ìƒëª… êµ¬ì¡° ì„œë¹„ìŠ¤ ì¦‰ì‹œ ì ‘ì†
                        </button>
                    </form>
                </div>
            `;

            document.body.appendChild(emergencyContainer);

            // í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const form = document.getElementById('emergency-login-form-direct');
            form.addEventListener('submit', handleDirectEmergencyLogin);
        }

        // ì§ì ‘ ê¸´ê¸‰ ë¡œê·¸ì¸ ì²˜ë¦¬
        async function handleDirectEmergencyLogin(event) {
            event.preventDefault();
            
            const name = document.getElementById('emergency-name-direct').value.trim();
            const phone = document.getElementById('emergency-phone-direct').value.trim();

            if (!name || !phone) {
                alert('ì´ë¦„ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            console.log('ğŸš¨ ì§ì ‘ ê¸´ê¸‰ ë¡œê·¸ì¸ ì²˜ë¦¬:', { name, phone });

            try {
                // ì„ì‹œ ì‚¬ìš©ì ID ìƒì„±
                const emergencyUserId = 'emergency_' + phone.replace(/[^0-9]/g, '');
                
                // ì‚¬ìš©ì ì •ë³´ ìƒì„±
                const emergencyUserInfo = {
                    id: emergencyUserId,
                    name: name,
                    nickname: name,
                    phone: phone,
                    provider: 'emergency',
                    is_emergency_user: true,
                    emergency_contact1: phone,
                    emergency_name1: name,
                    created_at: new Date().toISOString(),
                    profile_image: '',
                    email: `${emergencyUserId}@emergency.lonely-care.com`
                };

                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('currentUser', JSON.stringify(emergencyUserInfo));
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('isEmergencyLogin', 'true');

                console.log('âœ… ê¸´ê¸‰ ë¡œê·¸ì¸ ì™„ë£Œ - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
                
                // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ í›„ ìƒˆë¡œê³ ì¹¨
                alert(`í™˜ì˜í•©ë‹ˆë‹¤, ${name}ë‹˜!\nLonely Care ìƒëª…ì•ˆì „ ì„œë¹„ìŠ¤ì— ì ‘ì†ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                window.location.reload();

            } catch (error) {
                console.error('âŒ ì§ì ‘ ê¸´ê¸‰ ë¡œê·¸ì¸ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ê¸´ê¸‰ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜
        function showPage(pageId) {
            console.log('ğŸ”„ í˜ì´ì§€ ì „í™˜:', pageId);
            
            // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
            });

            // ì„ íƒëœ í˜ì´ì§€ í‘œì‹œ
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                targetPage.style.display = 'block';
                console.log('âœ… í˜ì´ì§€ í‘œì‹œ:', pageId);
            } else {
                console.error('âŒ í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', pageId);
            }

            // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const navButton = document.querySelector(`#nav-${pageId.replace('-page', '')}`);
            if (navButton) {
                navButton.classList.add('active');
                console.log('âœ… ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í™œì„±í™”:', navButton.id);
            } else {
                console.error('âŒ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', `#nav-${pageId.replace('-page', '')}`);
            }
        }

        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”„ DOM ë¡œë“œ ì™„ë£Œ - ì´ˆê¸°í™” ì‹œì‘');
            
            // Firebase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
            if (!window.firebaseClient && window.firebaseConfig) {
                try {
                    // Firebase ì•± ì´ˆê¸°í™”
                    const firebaseApp = firebase.initializeApp(window.firebaseConfig);
                    const db = firebase.firestore();
                    
                    // ì „ì—­ firebaseClient ê°ì²´ ìƒì„±
                    window.firebaseClient = {
                        app: firebaseApp,
                        db: db,
                        isInitialized: true
                    };
                    
                    console.log('ğŸ”¥ Firebase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
                } catch (error) {
                    console.error('âŒ Firebase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    window.firebaseClient = {
                        app: null,
                        db: null,
                        isInitialized: false
                    };
                }
            }
            
            // ë¡œê·¸ì¸ ìƒíƒœ ì¬í™•ì¸ - ë” ì—„ê²©í•œ ê²€ì¦
            var savedUser = localStorage.getItem('currentUser');
            var isLoggedIn = false;
            
            if (savedUser) {
                try {
                    var userData = JSON.parse(savedUser);
                    if (userData && userData.id && userData.name && (userData.kakao_id || userData.kakaoId)) {
                        isLoggedIn = true;
                    } else {
                        localStorage.removeItem('currentUser');
                    }
                } catch (e) {
                    localStorage.removeItem('currentUser');
                }
            }
            
            // ìƒíƒœì— ë”°ë¥¸ í™”ë©´ ì„¤ì •
            var authContainer = document.getElementById('auth-container');
            var mainApp = document.getElementById('main-app');
            var bottomNav = document.getElementById('bottom-nav');
            
            console.log('ğŸ” ìµœì¢… ë¡œê·¸ì¸ ìƒíƒœ íŒë‹¨:', isLoggedIn ? 'ë¡œê·¸ì¸ë¨' : 'ë¡œê·¸ì•„ì›ƒë¨');
            
            if (isLoggedIn) {
                // ë¡œê·¸ì¸ëœ ìƒíƒœ: ë©”ì¸ ì•± í‘œì‹œ
                if (authContainer) {
                    authContainer.classList.add('hidden');
                    authContainer.style.display = 'none';
                }
                if (mainApp) {
                    mainApp.classList.remove('hidden');
                    mainApp.classList.add('show');
                    mainApp.style.display = 'block';
                }
                if (bottomNav) bottomNav.style.display = 'flex';
                
                // ê¸°ë³¸ í˜ì´ì§€ (ì¹œêµ¬ ê´€ë¦¬) í™œì„±í™”
                setTimeout(() => {
                    showPage('friends-page');
                }, 100);
                
                console.log('âœ… ë©”ì¸ ì•± í‘œì‹œ ì™„ë£Œ - ë¡œê·¸ì¸ ìƒíƒœ');
            } else {
                // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ: ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
                if (authContainer) {
                    authContainer.classList.remove('hidden');
                    authContainer.style.display = 'block';
                }
                if (mainApp) {
                    mainApp.classList.add('hidden');
                    mainApp.classList.remove('show');
                    mainApp.style.display = 'none';
                }
                if (bottomNav) bottomNav.style.display = 'none';
                console.log('âœ… ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ ì™„ë£Œ - ë¡œê·¸ì•„ì›ƒ ìƒíƒœ');
            }
            
            // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼
            const kakaoLoginBtn = document.getElementById('kakao-login-btn');
            if (kakaoLoginBtn) {
                kakaoLoginBtn.addEventListener('click', performKakaoLogin);
            }

            // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ë“¤
            document.getElementById('nav-friends')?.addEventListener('click', () => showPage('friends-page'));
            document.getElementById('nav-status')?.addEventListener('click', () => showPage('status-page'));
            document.getElementById('nav-ads')?.addEventListener('click', () => showPage('ads-page'));
            document.getElementById('nav-notifications')?.addEventListener('click', () => showPage('notifications-page'));
            document.getElementById('nav-profile')?.addEventListener('click', () => showPage('profile-page'));

            // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
            document.getElementById('logout-profile-btn')?.addEventListener('click', function() {
                if (confirm('ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    localStorage.removeItem('currentUser');
                    window.location.reload();
                }
            });

            // ğŸ’³ êµ¬ë… ê´€ë¦¬ ë²„íŠ¼ë“¤
            document.getElementById('basic-upgrade-btn')?.addEventListener('click', function() {
                if (window.subscriptionManager) {
                    window.subscriptionManager.startUpgrade('BASIC');
                } else {
                    console.error('âŒ subscriptionManagerê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    alert('êµ¬ë… ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            });

            document.getElementById('premium-upgrade-btn')?.addEventListener('click', function() {
                if (window.subscriptionManager) {
                    window.subscriptionManager.startUpgrade('PREMIUM');
                } else {
                    console.error('âŒ subscriptionManagerê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    alert('êµ¬ë… ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            });

            document.getElementById('auto-renew-toggle-btn')?.addEventListener('click', function() {
                if (window.subscriptionManager) {
                    window.subscriptionManager.toggleAutoRenew();
                } else {
                    console.error('âŒ subscriptionManagerê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    alert('êµ¬ë… ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            });

            document.getElementById('cancel-subscription-btn')?.addEventListener('click', function() {
                if (window.subscriptionManager) {
                    window.subscriptionManager.cancelSubscription();
                } else {
                    console.error('âŒ subscriptionManagerê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    alert('êµ¬ë… ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            });

            document.getElementById('manage-subscription-btn')?.addEventListener('click', function() {
                if (window.subscriptionManager) {
                    window.subscriptionManager.showSubscriptionManagement();
                } else {
                    console.error('âŒ subscriptionManagerê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    alert('êµ¬ë… ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            });

            
            console.log('âœ… DOM ì´ˆê¸°í™” ì™„ë£Œ');
        });

        // ì „í™”ë²ˆí˜¸ ìë™ í¬ë§·íŒ…
        function formatPhoneNumber(value) {
            const numbers = value.replace(/[^\d]/g, '');
            
            if (numbers.length <= 3) {
                return numbers;
            } else if (numbers.length <= 7) {
                return numbers.slice(0, 3) + '-' + numbers.slice(3);
            } else if (numbers.length <= 11) {
                return numbers.slice(0, 3) + '-' + numbers.slice(3, 7) + '-' + numbers.slice(7);
            } else {
                return numbers.slice(0, 3) + '-' + numbers.slice(3, 7) + '-' + numbers.slice(7, 11);
            }
        }

        // ì „í™”ë²ˆí˜¸ í•„ë“œì— í¬ë§·íŒ… ì ìš©
        document.addEventListener('DOMContentLoaded', function() {
            const phoneFields = ['profile-phone', 'emergency-contact1', 'emergency-contact2'];
            
            phoneFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', function(e) {
                        const cursorPosition = e.target.selectionStart;
                        const oldValue = e.target.value;
                        const newValue = formatPhoneNumber(oldValue);
                        
                        e.target.value = newValue;
                        
                        let newCursorPosition = cursorPosition;
                        if (newValue.length > oldValue.length) {
                            if (cursorPosition === 4 || cursorPosition === 9) {
                                newCursorPosition = cursorPosition + 1;
                            }
                        }
                        e.target.setSelectionRange(newCursorPosition, newCursorPosition);
                    });
                    
                    field.addEventListener('paste', function(e) {
                        setTimeout(() => {
                            e.target.value = formatPhoneNumber(e.target.value);
                        }, 0);
                    });
                }
            });
        });
    </script>

    <!-- lonely-care í•µì‹¬ JavaScript íŒŒì¼ë“¤ ë¡œë“œ -->
    <!-- 0. í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ìµœìš°ì„  ë¡œë“œ) -->
    <script src="js/env-config.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <!-- 1. ê¸°ë³¸ ì„¤ì • ë° ìœ í‹¸ë¦¬í‹° -->
    <script src="js/config.js"></script>
    <script src="js/debug-logger.js"></script>
    
    <!-- UserID ìœ í‹¸ë¦¬í‹° (ìµœìš°ì„  ë¡œë“œ - ë‹¤ë¥¸ íŒŒì¼ë“¤ì—ì„œ ì‚¬ìš©) -->
    <script src="js/user-id-utils.js"></script>
    
    <!-- í—¬í¼ í´ë˜ìŠ¤ë“¤ (ìµœìš°ì„  ë¡œë“œ) -->
    <script src="js/helpers/error-handler.js"></script>
    <script src="js/helpers/dom-helper.js"></script>
    <script src="js/helpers/storage-helper.js"></script>
    <script src="js/helpers/notification-helper.js"></script>
    <script src="js/helpers/user-gesture-manager.js"></script>
    <script src="js/helpers/network-optimizer.js"></script>
    <script src="js/helpers/image-cache.js"></script>
    <script src="js/helpers/async-optimizer.js"></script>
    <script src="js/helpers/network-recovery.js"></script>
    
    <!-- HTTPS ë° ë³´ì•ˆ ê´€ë¦¬ -->
    <!-- <script src="js/https-manager.js"></script> ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒŒì¼ -->
    
    <!-- Firebase ì„¤ì • ë° ì €ì¥ì†Œ (ìˆœì„œ ì¤‘ìš”!) -->
    <script src="js/firebase-initializer.js"></script>
    <!-- <script src="js/firebase-connection-monitor.js"></script> ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒŒì¼ -->
    <script src="js/firebase-client.js"></script>
    <script src="js/firebase-compat.js"></script>
    <script src="js/storage.js"></script>
    
    <!-- ì‹¤ì‹œê°„ ìƒíƒœ ê´€ë¦¬ì (í”„ë¼ì´ë²„ì‹œ ë³´í˜¸ í¬í•¨) -->
    <script src="components/core/RealTimeStatusManager.js"></script>
    
    <!-- 2. ì¸ì¦ ì‹œìŠ¤í…œ -->
    <script src="js/auth.js"></script>
    <script src="js/kakao-auth.js"></script>
    <script src="js/kakao-auth-standalone.js"></script>
    
    <!-- 2-1. ê¸´ê¸‰ ë¡œê·¸ì¸ ì‹œìŠ¤í…œ (ìƒëª… êµ¬ì¡° ìš°ì„ ) -->
    <script src="components/auth/emergency-login.js"></script>
    
    <!-- 3-1. ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ ì‹œìŠ¤í…œ (Firebase ê¸°ë°˜) -->
    <script src="components/auth/KakaoAuthComponent.js"></script>
    
    <!-- 3-2. ê¸°ëŠ¥ ëª¨ë“ˆë“¤ (authê°€ ì´ˆê¸°í™”ëœ í›„) -->
    <script src="js/friends.js"></script>
    
    <!-- 3-2-1. ì¹œêµ¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ (ëª¨ë“ˆí™”ëœ ë²„ì „) -->
    <script src="js/modules/alert-level-manager.js"></script>
    <script src="js/modules/notification-threshold-manager.js"></script>
    <script src="js/modules/friend-status-checker.js"></script>
    <script src="js/modules/friend-status-ui.js"></script>
    <script src="js/friend-status-monitor.js"></script>
    
    <script src="js/invite-code.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/dynamic-time-display.js"></script>
    <script src="js/modules/fcm-token-manager-v2.js?v=13.5.1-final-cache-break&t=1730695200"></script>
    <!-- <script src="js/fcm-manager.js"></script> íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ ì£¼ì„ ì²˜ë¦¬ -->
    <script src="js/enhanced-motion-detector.js"></script>
    <script src="js/motion-detector.js"></script>
    <script src="js/status.js"></script>
    
    <!-- ğŸ’³ í¬ë¡œìŠ¤ í”Œë«í¼ ê²°ì œ ì‹œìŠ¤í…œ -->
    <!-- <script src="js/android-billing-handler.js"></script> ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒŒì¼ -->
    <!-- <script src="js/ios-payment-handler.js"></script> ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒŒì¼ -->
    <!-- <script src="js/web-payment-handler.js"></script> ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒŒì¼ -->
    <!-- <script src="js/cross-platform-payment.js"></script> ì¡´ì¬í•˜ì§€ ì•ŒëŠ” íŒŒì¼ -->
    <script src="js/subscription-manager.js"></script>
    
    <!-- ğŸ› ï¸ ê²°ì œ ì‹œìŠ¤í…œ ë¬¸ì œ ìˆ˜ì • -->
    <!-- <script src="js/payment-fix-initializer.js"></script> ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒŒì¼ -->
    
    <!-- ğŸš¨ 119 ì‘ê¸‰ì‹ ê³  API ì‹œìŠ¤í…œ -->
    <!-- <script src="js/api-119-client.js"></script> ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒŒì¼ -->
    
    <!-- 4. UI ì»´í¬ë„ŒíŠ¸ë“¤ -->
    <script src="components/ui/AdBannerComponent.js"></script>
    
    <!-- 5. ê¸´ê¸‰ìƒí™© ëŒ€ì‘ ì‹œìŠ¤í…œ -->
    <script src="components/emergency/EmergencyResponseSystem.js"></script>
    
    <!-- 6. ë©”ì¸ ì•± (ë§ˆì§€ë§‰ì— ë¡œë“œ) -->
    <script src="js/main.js"></script>
    
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì¹œêµ¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì‹œì‘
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”„ ì¹œêµ¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì´ˆê¸°í™” ì‹œì‘...');
            
            // ì•±ì´ ì™„ì „íˆ ë¡œë“œë˜ê¸°ê¹Œì§€ ì¶©ë¶„íˆ ê¸°ë‹¤ë¦° í›„ ë°ì´í„° ë¡œë“œ
            setTimeout(() => {
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    console.log('âœ… ì‚¬ìš©ì ë¡œê·¸ì¸ í™•ì¸ë¨, ì¹œêµ¬ ë°ì´í„° ë¡œë“œ ì¤‘...');
                    
                    // auth ê°ì²´ê°€ ì´ˆê¸°í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸
                    if (typeof window.auth !== 'undefined' && window.auth) {
                        console.log('âœ… auth ê°ì²´ ì´ˆê¸°í™” í™•ì¸ë¨');
                        
                        // ì¹œêµ¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì‹œì‘
                        if (window.friendStatusMonitor) {
                            try {
                                // ë¨¼ì € ì´ˆê¸°í™”
                                if (!window.friendStatusMonitor.isInitialized) {
                                    console.log('ğŸ”„ friendStatusMonitor ì´ˆê¸°í™” ì¤‘...');
                                    window.friendStatusMonitor.init();
                                }
                                
                                // ê·¸ ë‹¤ìŒ ë°ì´í„° ë¡œë“œ
                                if (typeof window.friendStatusMonitor.loadFriendsStatus === 'function') {
                                    window.friendStatusMonitor.loadFriendsStatus();
                                    console.log('âœ… ì¹œêµ¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì‹œì‘ë¨');
                                }
                            } catch (error) {
                                console.error('âŒ ì¹œêµ¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì‹œì‘ ì‹¤íŒ¨:', error);
                            }
                        } else {
                            console.error('âŒ friendStatusMonitor ê°ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        }
                        
                        // ì¹œêµ¬ ëª©ë¡ ë¡œë“œ
                        if (window.friendManager && typeof window.friendManager.loadFriends === 'function') {
                            try {
                                window.friendManager.loadFriends();
                                console.log('âœ… ì¹œêµ¬ ëª©ë¡ ë¡œë“œ ì‹œì‘ë¨');
                            } catch (error) {
                                console.error('âŒ ì¹œêµ¬ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                            }
                        }
                    } else {
                        console.warn('âš ï¸ auth ê°ì²´ê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ. ì¬ì‹œë„í•˜ì§€ ì•ŠìŒ.');
                        // ë¬´í•œ ë£¨í”„ ë°©ì§€ - ì¬ì‹œë„í•˜ì§€ ì•ŠìŒ
                    }
                } else {
                    console.log('â„¹ï¸ ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìƒíƒœì…ë‹ˆë‹¤');
                }
            }, 2000);
        });

    </script>

    <!-- ğŸ†˜ ìƒëª…êµ¬ì¡° ì‹œìŠ¤í…œ ê°œì„ ì‚¬í•­ - JavaScript ì»´í¬ë„ŒíŠ¸ë“¤ -->
    <script src="components/core/AntiSpoofingManager.js"></script>
    <script src="components/notifications/EnhancedNotificationManager-v2.js?v=13.5.1-final-cache-break&t=1730695200"></script>
    <script src="components/ui/FriendCardStyleManager-v2.js?v=13.5.1-final-cache-break&t=1730695200"></script>
    <script src="components/core/LifeSaverNotificationIntegrator.js"></script>
    <script src="components/testing/LifeSaverSystemTester.js"></script>
    <script src="components/LifeSaverMasterInitializer.js"></script>
    
    <!-- FCM ë°±ê·¸ë¼ìš´ë“œ ì•Œë¦¼ í…ŒìŠ¤í„° - ê°œë°œ/í…ŒìŠ¤íŠ¸ìš© -->
    <script src="components/notifications/FCMBackgroundTester.js"></script>
    
    <!-- ğŸ§¹ ìƒì‚° í™˜ê²½ ì •ë¦¬ ìŠ¤í¬ë¦½íŠ¸ - í…ŒìŠ¤íŠ¸ UI ì™„ì „ ì œê±° -->
    <!-- <script src="js/production-cleanup.js"></script> ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒŒì¼ -->
    
    <!-- ğŸ”§ ìƒëª…êµ¬ì¡° ì•± ë””ë²„ê¹… ìŠ¤í¬ë¦½íŠ¸ - ì¹œêµ¬ ë¡œë”© ë¬¸ì œ ì§„ë‹¨ -->
    <!-- <script src="debug-friends-loading.js"></script> ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŒŒì¼ -->
</body>
</html>